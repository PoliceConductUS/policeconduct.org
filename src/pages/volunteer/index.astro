---
import SiteLayout from "../../layouts/SiteLayout.astro";
---

<SiteLayout title="Volunteer | PoliceConduct.org" pagePath="/volunteer/">
  <main class="flex-grow-1 py-vh-3">
    <div class="container">
      <div class="row align-items-start mb-5">
        <div class="col-lg-7">
          <p class="text-uppercase small text-muted mb-2">Join the team</p>
          <h1 class="display-5 fw-bold">Volunteer</h1>
          <p class="lead text-muted">
            Volunteers help us review submissions, expand partnerships, and keep
            PoliceConduct.org responsive to communities nationwide.
          </p>
          <div class="row g-3 mt-4">
            <div class="col-md-6">
              <div class="p-4 border rounded h-100">
                <h2 class="h5 fw-semibold mb-2">Report Review</h2>
                <p class="text-muted mb-0">
                  Help verify submissions, flag sensitive details, and prepare
                  reports for publication.
                </p>
              </div>
            </div>
            <div class="col-md-6">
              <div class="p-4 border rounded h-100">
                <h2 class="h5 fw-semibold mb-2">Research and Outreach</h2>
                <p class="text-muted mb-0">
                  Support partnerships with agencies, nonprofits, and local
                  advocates.
                </p>
              </div>
            </div>
            <div class="col-md-6">
              <div class="p-4 border rounded h-100">
                <h2 class="h5 fw-semibold mb-2">Data and Product</h2>
                <p class="text-muted mb-0">
                  Contribute to data quality, taxonomy, and product
                  improvements.
                </p>
              </div>
            </div>
            <div class="col-md-6">
              <div class="p-4 border rounded h-100">
                <h2 class="h5 fw-semibold mb-2">Legal or Advocacy</h2>
                <p class="text-muted mb-0">
                  Help us align reports with policy needs and legal context.
                </p>
              </div>
            </div>
            <div class="col-md-6">
              <div class="p-4 border rounded h-100">
                <h2 class="h5 fw-semibold mb-2">Media and Storytelling</h2>
                <p class="text-muted mb-0">
                  Assist with publishing stories that make reports
                  understandable to the public.
                </p>
              </div>
            </div>
            <div class="col-md-6">
              <div class="p-4 border rounded h-100">
                <h2 class="h5 fw-semibold mb-2">Software Engineer</h2>
                <p class="text-muted mb-0">
                  Help build tools for intake, review workflows, and public
                  transparency features.
                </p>
              </div>
            </div>
            <div class="col-md-6">
              <div class="p-4 border rounded h-100">
                <h2 class="h5 fw-semibold mb-2">Board Member</h2>
                <p class="text-muted mb-0">
                  Provide governance, strategic guidance, and nonprofit
                  oversight. Board roles typically require a background check
                  and a commitment of several hours per month.
                </p>
              </div>
            </div>
            <div class="col-md-6">
              <div class="p-4 border rounded h-100">
                <h2 class="h5 fw-semibold mb-2">Other</h2>
                <p class="text-muted mb-0">
                  Let us know what you can contribute and we will match you to a
                  role.
                </p>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-5">
          <div class="border p-4 bg-white shadow-sm">
            <h2 class="h5 fw-semibold">Volunteer interest form</h2>
            <p class="text-muted mb-3">
              Share your details and we will follow up with onboarding steps.
            </p>
            <form
              name="volunteer"
              method="POST"
              data-netlify="true"
              data-netlify-honeypot="organization"
              class="needs-validation"
              novalidate
            >
              <input type="hidden" name="form-name" value="volunteer" />
              <div class="honeypot visually-hidden">
                <label>
                  Organization
                  <input type="text" name="organization" />
                </label>
              </div>
              <div class="form-floating mb-3">
                <input
                  type="text"
                  class="form-control"
                  id="volunteerName"
                  name="name"
                  placeholder="Full name"
                  required
                />
                <label for="volunteerName">Full name*</label>
                <div class="invalid-feedback">Please provide your name.</div>
              </div>
              <div class="form-floating mb-3">
                <input
                  type="email"
                  class="form-control"
                  id="volunteerEmail"
                  name="email"
                  placeholder="Email"
                  required
                />
                <label for="volunteerEmail">Email*</label>
                <div class="invalid-feedback">
                  Please provide a valid email.
                </div>
              </div>
              <div class="form-floating mb-3">
                <input
                  type="tel"
                  class="form-control"
                  id="volunteerPhone"
                  name="phone"
                  placeholder="Phone"
                  required
                />
                <label for="volunteerPhone">Phone*</label>
                <div class="invalid-feedback">
                  Please provide a phone number.
                </div>
              </div>
              <div class="form-floating mb-3">
                <input
                  type="text"
                  class="form-control"
                  id="volunteerLocation"
                  name="location"
                  placeholder="City, state, time zone"
                />
                <label for="volunteerLocation">Location or time zone</label>
              </div>
              <div class="form-floating mb-3">
                <select
                  class="form-select"
                  id="volunteerInterest"
                  name="interest"
                  required
                >
                  <option value="" selected>Select a focus</option>
                  <option value="Board Member">Board Member</option>
                  <option value="Data and Product">Data and Product</option>
                  <option value="Legal or Advocacy">Legal or Advocacy</option>
                  <option value="Media and Storytelling">
                    Media and Storytelling
                  </option>
                  <option value="Other">Other</option>
                  <option value="Report Review">Report Review</option>
                  <option value="Research and Outreach">
                    Research and Outreach
                  </option>
                  <option value="Software Engineer">Software Engineer</option>
                </select>
                <label for="volunteerInterest">Primary interest*</label>
                <div class="invalid-feedback">
                  Please select an interest area.
                </div>
              </div>
              <div class="form-floating mb-3">
                <textarea
                  class="form-control"
                  id="volunteerSkills"
                  name="skills"
                  placeholder="Skills or experience"
                  style="height: 120px"></textarea>
                <label for="volunteerSkills">Skills or experience</label>
              </div>
              <div class="form-floating mb-3">
                <textarea
                  class="form-control"
                  id="volunteerAvailability"
                  name="availability"
                  placeholder="Availability"
                  style="height: 110px"></textarea>
                <label for="volunteerAvailability">Availability</label>
              </div>
              <div class="form-check mb-3">
                <input
                  class="form-check-input"
                  type="checkbox"
                  value="Yes"
                  id="volunteerConsent"
                  name="consent"
                  required
                />
                <label class="form-check-label" for="volunteerConsent">
                  I understand PoliceConduct.org may contact me about volunteer
                  opportunities.
                </label>
                <div class="invalid-feedback">Consent is required.</div>
              </div>
              <div class="small text-muted mb-3">
                Protected by reCAPTCHA Enterprise.
              </div>
              <button type="submit" class="btn btn-dark rounded-0 w-100">
                Submit volunteer interest
              </button>
            </form>
            <p class="small text-muted mt-3 mb-0">
              We review every inquiry and respond from
              volunteer@policeconduct.org.
            </p>
          </div>
        </div>
      </div>

      <div class="mt-5 border-top pt-4">
        <p class="text-muted mb-2">Not sure where to start?</p>
        <a href="/about/contact?whoami=Volunteer" class="link-dark"
          >Reach out and we will match you to a role.</a
        >
      </div>
    </div>
  </main>
  <script is:inline>
    (function () {
      const form = document.querySelector('form[name="volunteer"]');
      if (!form) {
        return;
      }
      form.addEventListener("submit", async function (event) {
        const submitButton = form.querySelector('button[type="submit"]');
        let inlineError = form.querySelector("[data-form-submit-error]");
        if (!inlineError) {
          inlineError = document.createElement("div");
          inlineError.setAttribute("data-form-submit-error", "true");
          inlineError.className = "alert alert-danger rounded-0 mt-3 d-none";
          inlineError.setAttribute("role", "alert");
          form.appendChild(inlineError);
        }

        event.preventDefault();
        if (submitButton) submitButton.disabled = true;
        inlineError.classList.add("d-none");
        inlineError.textContent = "";

        try {
          if (!form.checkValidity()) {
            event.stopPropagation();
            form.classList.add("was-validated");
            return;
          }
          form.classList.add("was-validated");

          const formData = new FormData(form);
          const recaptchaSiteKey = String(
            window.__RECAPTCHA_SITE_KEY__ || "",
          ).trim();
          if (
            !recaptchaSiteKey ||
            !window.grecaptcha ||
            !window.grecaptcha.enterprise
          ) {
            throw new Error("reCAPTCHA is not configured.");
          }

          const recaptchaToken = await new Promise((resolve, reject) => {
            window.grecaptcha.enterprise.ready(async function () {
              try {
                const token = await window.grecaptcha.enterprise.execute(
                  recaptchaSiteKey,
                  {
                    action: "volunteer_submit",
                  },
                );
                resolve(token);
              } catch (error) {
                reject(error);
              }
            });
          });

          if (!recaptchaToken) {
            throw new Error("Unable to validate reCAPTCHA.");
          }

          const data = {};
          formData.forEach((value, key) => {
            if (key === "form-name" || key === "g-recaptcha-response") {
              return;
            }
            if (key in data) {
              if (!Array.isArray(data[key])) {
                data[key] = [data[key]];
              }
              data[key].push(value);
            } else {
              data[key] = value;
            }
          });

          const response = await fetch("/api/forms/submit", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              formName: "volunteer",
              recaptchaToken,
              data,
            }),
          });

          if (!response.ok) {
            let message =
              "We could not submit your form right now. Please print this page and email it to hello@policeconduct.org so we have your submission while we fix the issue.";
            try {
              const errorPayload = await response.json();
              if (
                errorPayload &&
                typeof errorPayload.error === "string" &&
                errorPayload.error.trim()
              ) {
                message = errorPayload.error.trim();
              }
            } catch (_error) {
              // Ignore malformed error payloads.
            }
            throw new Error(message);
          }

          const result = await response.json();
          const submissionId =
            typeof result?.submissionId === "string" ? result.submissionId : "";
          if (!submissionId) {
            throw new Error(
              "Submission succeeded but no submission ID was returned.",
            );
          }

          form.reset();
          form.classList.remove("was-validated");
          alert(
            `Submission received.\n\nSubmission ID: ${submissionId}\n\nSave this ID in a safe place. It cannot be recovered or displayed again. Use it for follow-up questions or change requests.`,
          );
        } catch (error) {
          const message =
            error instanceof Error && error.message
              ? error.message
              : "Unable to submit the form. Please try again.";
          inlineError.textContent = message;
          inlineError.classList.remove("d-none");
        } finally {
          if (submitButton) submitButton.disabled = false;
        }
      });
    })();
  </script>
</SiteLayout>
