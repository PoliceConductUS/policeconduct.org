---
import type { PersonnelSummary } from "../lib/data/types.js";

const { person } = Astro.props as { person: PersonnelSummary };

const formatDate = (value: string | null) => {
  if (!value) {
    return null;
  }
  const date = new Date(value);
  if (Number.isNaN(date.getTime())) {
    return null;
  }
  return date.toLocaleDateString("en-US", {
    month: "short",
    day: "numeric",
    year: "numeric",
  });
};

const fullName = `${person.lastName}, ${person.firstName}${
  person.nameSuffix ? ` ${person.nameSuffix}` : ""
}`;
const initials =
  `${person.firstName?.[0] || ""}${person.lastName?.[0] || ""}`.toUpperCase();
const detailUrl = `/personnel/${person.slug}/`;
const agencyUrl = `/law-enforcement-agency/${person.agencySlug}/`;
const lastUpdatedLabel = formatDate(person.lastUpdatedAt);
const reportLabel = `${person.reportCount} reports`;
---

<article class="card h-100 shadow-sm border-0 rounded-0">
  <div class="card-body d-flex flex-column gap-3">
    <div class="d-flex align-items-start gap-3">
      <div
        class="rounded-circle bg-dark text-white d-flex align-items-center justify-content-center fw-bold flex-shrink-0"
        style="width: 44px; height: 44px;"
        aria-hidden="true"
      >
        {initials}
      </div>
      <div class="flex-grow-1 position-relative">
        <div class="d-flex flex-wrap align-items-center gap-2 mb-2">
          <span class="badge bg-dark rounded-0">Active</span>
          {
            person.roleTitle ? (
              <span class="badge bg-light text-dark border rounded-0">
                {person.roleTitle}
              </span>
            ) : null
          }
        </div>
        <h3 class="h5 mb-1">
          <a class="link-dark text-decoration-none" href={detailUrl}>
            {fullName}
          </a>
        </h3>
        <div class="text-muted small">
          <a class="link-secondary text-decoration-none" href={agencyUrl}>
            {person.agencyName}
          </a>
        </div>
      </div>
    </div>
    <div
      class="d-flex flex-wrap gap-2 align-items-center text-muted small border-top pt-2"
    >
      <span class="badge bg-light text-dark border rounded-0"
        >{reportLabel}</span
      >
      <a
        class="badge bg-light text-dark border rounded-0 text-decoration-none"
        href={`${detailUrl}#disqus_thread`}
        data-disqus-identifier={`personnel:${person.slug}`}
      >
        Comments
      </a>
      <a
        class="badge bg-light text-dark border rounded-0 text-decoration-none"
        href={agencyUrl}
      >
        {person.agencyName}
      </a>
      {
        lastUpdatedLabel ? (
          <span class="ms-auto fw-semibold text-dark">
            Updated {lastUpdatedLabel}
          </span>
        ) : null
      }
    </div>
  </div>
</article>
